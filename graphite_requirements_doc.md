# 人工合成石墨实验及样品数据管理系统需求说明文档

## 1. 项目概述

### 1.1 项目背景
- **当前痛点：** 石墨样品测试和实验信息缺乏电子化管理，数据分析和对比困难
- **解决目标：** 建立完整的实验数据电子化记录、存储、分析和对比系统
- **预期收益：** 提升数据管理效率，实现工艺参数优化，建立标准化的质量管控体系

### 1.2 系统定位
- **主要用户：** 管理员、工程师、实验操作人员
- **使用场景：** 实验数据录入、样品信息管理、数据分析对比、质量控制
- **部署方式：** 本地Windows环境，Web系统，支持多用户同时操作

### 1.3 用户规模与数据量
- **用户数量：** 预计20人左右，同时在线用户约5人
- **数据量：** 预计每年产生200-300条实验记录
- **并发需求：** 无需考虑数据锁定，简单的并发控制即可

## 2. 功能需求

### 2.1 核心功能模块（按开发优先级排序）

#### Phase 1 - 基础数据管理系统（立即开发）
```
🔐 用户认证与权限管理
├── 用户登录系统
├── 三级权限控制（管理员/工程师/用户）
├── 权限验证和页面访问控制
└── 用户会话管理

📝 实验数据录入模块
├── 创建新实验（7个功能模块）
│   ├── 1. 实验设计参数（10个字段）
│   ├── 2. PI膜参数（6个字段）
│   ├── 3. 松卷参数（4个字段）
│   ├── 4. 碳化参数（20个字段，含照片上传）
│   ├── 5. 石墨化参数（29个字段，含照片上传）
│   ├── 6. 压延参数（4个字段）
│   └── 7. 成品参数（16个字段，含2个照片上传）
├── 实验编码自动生成
├── 数据验证和完整性检查
├── 草稿保存和正式提交
└── 文件上传管理

📂 实验数据管理模块
├── 未完成实验管理
├── 实验数据库查询
├── 数据导出（CSV格式）
└── 实验记录编辑和删除（权限控制）

🔍 数据查询与检索模块
├── 单一实验查询（实验编号选择）
├── 多重条件查询（PI膜厚度→厂商→型号→实验编号）
├── 高级筛选功能
└── 搜索下拉框实现
```

#### Phase 2 - 数据分析系统（预留接口，后续开发）
```
📊 数据对比与分析模块
├── 实验数据对比（多实验并排对比）
├── 参数关系分析
├── 数据可视化图表
└── 分析报告生成

🔧 系统管理模块
├── 用户和权限管理
├── 数据库备份和恢复
├── 系统配置管理
└── 操作日志管理
```

### 2.2 详细功能描述

#### 2.2.1 用户权限管理
```
管理员权限：
✅ 系统所有功能访问权限
✅ 创建、编辑、删除实验数据
✅ 查看所有用户的实验记录
✅ 删除实验记录
✅ 数据导出功能
✅ 数据对比与分析
✅ 用户管理：添加、编辑、删除用户，修改权限
✅ 数据库备份和恢复

工程师权限：
✅ 创建、编辑实验数据
✅ 查看所有用户的未完成实验
✅ 查看、编辑、导出所有实验记录（不能删除）
✅ 数据对比与分析
✅ 保存草稿和提交数据库
❌ 系统管理（显示入口但禁止访问）

用户权限：
✅ 创建、编辑实验数据
✅ 查看、修改自己创建的未完成实验
✅ 保存草稿
❌ 实验数据库（显示入口但禁止访问）
❌ 数据对比与分析（显示入口但禁止访问）
❌ 系统管理（显示入口但禁止访问）
```

#### 2.2.2 实验编码生成规则
```
编码组成：PI膜厚度 + 客户类型首字母 + 客户代码 + "-" + PI膜型号 + "-" + 实验日期后6位 + 烧制地点代码 + "-" + 送烧材料类型 + 压延方式 + 实验编组

示例：
输入参数：
- PI膜厚度：55
- 客户类型：International → I
- 客户名称：SA/三星 → SA  
- PI膜型号：THS55
- 实验申请日期：20250901 → 250901
- 烧制地点：DG
- 送烧材料类型：R（卷材）
- 压延方式：IR（内部辊压）
- 实验编组：01

生成编码：55ISA-THS55-250901DG-RIR01
```

#### 2.2.3 数据验证规则
```
草稿保存验证：
- 仅校验"实验设计参数"模块的必填字段（10个字段）
- 允许其他模块为空

正式提交验证：
- 校验所有40个必填字段
- 必填字段不能为空
- 数据格式验证（数值、日期、文件类型等）
- 实验编码唯一性验证
```

#### 2.2.4 文件上传管理
```
文件存储策略：
- 存储位置：服务器文件系统 /uploads/年份/月份/实验编码/
- 文件命名：字段名_时间戳.扩展名
- 大小限制：单文件不超过10MB
- 格式支持：jpg, png, pdf
- 自动压缩：大于2MB的图片压缩到70%质量
- 数据库记录：存储文件路径和元信息

涉及字段：
- 4.13 碳化装载方式照片
- 4.14 碳化样品照片
- 4.15 碳化其它参数
- 5.14 石墨化装载方式照片
- 5.15 石墨化样品照片
- 5.17 石墨化其它参数
- 7.12 外观不良照片
- 7.13 样品照片
- 7.15 其它文件
```

#### 2.2.5 搜索下拉框功能
```
触发条件：用户输入 ≥2个字符时触发搜索
筛选机制：自动筛选匹配的数据，下拉候选形式展示
返回限制：每次最多返回20条，支持分页参数
适用字段：
- PI膜厚度：搜索下拉
- 客户名称：搜索下拉  
- PI膜型号：搜索下拉
- PI膜厂商：搜索下拉
- PI膜初始厚度：搜索下拉
- [其他标注为"搜索下拉"的字段]
```

#### 2.2.6 数据对比功能
```
对比方式：
- 选择2个或更多实验编码
- 将每个实验的所有字段逐行列出
- 并排展示多个数据集

高亮规则：
- 数值字段：最大值橙色背景，最小值浅绿色背景
- 空值不参与最值计算
- 并列同等大小全部高亮
- 非数值字段不做高亮
```

## 3. 技术需求

### 3.1 开发环境
- **操作系统：** Windows 10 22H2
- **开发工具：** VSCode
- **终端工具：** PowerShell
- **版本控制：** Git（推荐）

### 3.2 技术栈
```
前端技术栈：
- 框架：Vue 3.x + Composition API
- UI组件库：Element Plus
- 构建工具：Vite
- 路由：Vue Router 4.x
- 状态管理：Pinia
- HTTP客户端：Axios
- 文件上传：Element Plus Upload组件

后端技术栈：
- 框架：Flask 2.x
- 数据库：MySQL 8.0（本地安装）
- ORM：SQLAlchemy
- 认证：Flask-JWT-Extended
- 文件处理：Werkzeug
- API设计：RESTful API

开发工具：
- 包管理：npm（前端）、pip（后端）
- 代码格式：Prettier、ESLint
- 调试工具：Vue DevTools、Flask Debug模式
```

### 3.3 性能需求
- **响应时间：** 页面加载<3秒，数据查询<2秒
- **并发用户：** 支持5个同时在线用户
- **数据容量：** 支持1万条实验记录
- **文件处理：** 图片上传和压缩在5秒内完成

### 3.4 兼容性需求
- **浏览器：** Chrome 90+、Firefox 88+、Edge 90+
- **设备：** PC桌面端为主
- **分辨率：** 1920x1080及以上

## 4. 数据库设计

### 4.1 表结构设计策略
```
主从表结构设计（8个表）：
- experiments（主表）：实验编码、状态、创建人、时间戳等核心信息
- experiment_basic（实验设计参数）：10个字段
- experiment_pi（PI膜参数）：6个字段  
- experiment_loose（松卷参数）：4个字段
- experiment_carbon（碳化参数）：20个字段
- experiment_graphite（石墨化参数）：29个字段
- experiment_rolling（压延参数）：4个字段
- experiment_product（成品参数）：16个字段
- users（用户表）：用户认证和权限管理
```

### 4.2 字段映射关系
```
数据库字段：使用英文字段名（如pi_film_thickness）
前端显示：使用中文字段名（如PI膜厚度）
字段映射：系统自动处理中英文字段名的对应关系

字段类型映射：
- 数值 → DECIMAL/INT
- 字符串 → VARCHAR/TEXT
- 日期 → DATE
- 时间点 → DATETIME
- 文件 → VARCHAR（存储文件路径）
```

### 4.3 数据完整性约束
```
主键约束：每个表都有自增主键id
外键约束：子表通过experiment_id关联主表
唯一约束：实验编码（experiment_code）全局唯一
检查约束：必填字段非空，数值范围校验
索引优化：在常用查询字段上建立索引
```

### 4.4 完整字段清单（90个字段）
```
实验设计参数模块（10个字段）：
1.1 PI膜厚度（μm） - pi_film_thickness - 数值 - 必填 - 搜索下拉
1.2 客户类型 - customer_type - 字符串 - 必填 - 普通下拉
1.3 客户名称 - customer_name - 字符串 - 必填 - 搜索下拉
1.4 PI膜型号 - pi_film_model - 字符串 - 必填 - 搜索下拉
1.5 实验申请日期 - experiment_date - 日期 - 必填
1.6 烧制地点 - sintering_location - 字符串 - 必填 - 搜索下拉
1.7 送烧材料类型 - material_type_for_firing - 字符串 - 必填 - 普通下拉
1.8 压延方式 - rolling_method - 字符串 - 必填 - 普通下拉
1.9 实验编组 - experiment_group - 数值 - 必填
1.10 实验编码 - experiment_code - 字符串 - 自动生成 - 唯一标识

[其余80个字段按Excel表格中的定义...]

必填字段总计：40个
下拉选择字段：11个
数据类型分布：数值54个，字符串22个，日期1个，时间点4个，文件9个
```

## 5. 用户界面需求

### 5.1 整体设计要求
- **语言：** 全中文界面
- **设计风格：** 现代化、专业、简洁
- **色彩搭配：** 蓝色系为主色调，体现科技和专业感
- **布局方式：** 响应式设计，适配不同屏幕尺寸

### 5.2 页面结构设计
```
登录页面：
- 用户名和密码输入
- 登录按钮
- 简洁的品牌标识

主导航页面（登录后）：
- 顶部：用户信息、登出功能
- 主要区域：5个功能模块卡片
  1. 创建新实验（所有用户）
  2. 未完成实验（所有用户）
  3. 实验数据库（管理员、工程师）
  4. 数据对比和分析（管理员、工程师）
  5. 系统管理（仅管理员）

实验录入页面：
- 7个功能模块的选项卡设计
- 分步骤录入，避免单页面过长
- 底部操作按钮：存为草稿、存入数据库
- 实时数据验证和错误提示

数据查询页面：
- 筛选条件区域
- 数据列表展示区域  
- 操作按钮区域（查看、编辑、导出、删除）
```

### 5.3 交互体验要求
```
表单交互：
- 必填字段红色星号标识
- 实时验证和错误提示
- 下拉选择支持搜索和键盘导航
- 文件上传进度显示

数据展示：
- 分页显示，每页20条记录
- 排序功能（点击列头排序）
- 快速筛选（常用条件的快捷按钮）
- 数据导出进度提示

权限控制：
- 无权限页面显示"你暂时无法访问此页面"
- 按钮灰化而非隐藏（提升用户认知）
- 操作确认弹窗（删除等敏感操作）
```

## 6. 安全需求

### 6.1 用户认证
- **登录方式：** 用户名+密码
- **会话管理：** JWT Token机制
- **密码策略：** 最少6位，包含字母和数字（可配置）
- **登录保护：** 连续失败3次锁定账户5分钟

### 6.2 权限控制
- **角色基础访问控制（RBAC）**
- **页面级权限验证**
- **API接口权限校验**
- **数据行级权限控制（用户只能访问自己的数据）**

### 6.3 数据安全
- **SQL注入防护：** 使用ORM参数化查询
- **文件上传安全：** 文件类型验证、大小限制、病毒扫描
- **敏感数据：** 密码加密存储（bcrypt）
- **操作日志：** 记录关键操作的审计日志

## 7. 部署运维需求

### 7.1 本地开发环境搭建
```
Python环境：
- Python 3.8+
- 虚拟环境管理（venv）
- 依赖包管理（requirements.txt）

Node.js环境：
- Node.js 16+
- npm包管理
- 前端构建工具配置

数据库环境：
- MySQL 8.0本地安装
- 数据库用户权限配置
- 初始化脚本和测试数据
```

### 7.2 项目结构
```
graphite-system/
├── backend/                 # Flask后端
│   ├── app/
│   │   ├── models/         # 数据模型
│   │   ├── routes/         # API路由
│   │   ├── utils/          # 工具函数
│   │   └── config.py       # 配置文件
│   ├── migrations/         # 数据库迁移
│   ├── uploads/           # 文件上传目录
│   └── requirements.txt   # Python依赖
├── frontend/              # Vue前端
│   ├── src/
│   │   ├── components/    # 组件
│   │   ├── views/         # 页面
│   │   ├── router/        # 路由配置
│   │   └── store/         # 状态管理
│   ├── public/           # 静态资源
│   └── package.json      # Node.js依赖
└── docs/                 # 项目文档
```

## 8. 项目计划与交付

### 8.1 开发阶段计划
```
Phase 1：基础架构搭建（1-2周）
- 项目框架搭建
- 数据库设计和建表
- 用户认证系统
- 基础页面框架

Phase 2：核心功能开发（3-4周）  
- 实验数据录入功能
- 文件上传功能
- 数据验证和保存
- 权限控制实现

Phase 3：数据管理功能（2-3周）
- 数据查询和展示
- 编辑和删除功能
- 导出功能
- 搜索下拉框

Phase 4：高级功能开发（2-3周）
- 数据对比功能
- 系统管理功能
- 备份恢复功能

Phase 5：测试和优化（1周）
- 功能测试
- 性能优化
- 用户体验调优
- 部署文档
```

### 8.2 交付物清单
```
代码交付：
✅ 完整的前后端源代码
✅ 数据库设计脚本和初始化数据
✅ 项目配置文件和环境说明

文档交付：
✅ 系统架构设计文档
✅ API接口文档
✅ 数据库设计文档  
✅ 部署和运维指南
✅ 用户操作手册

其他交付：
✅ 开发环境搭建指南
✅ 测试用例和测试报告
✅ 代码注释和技术说明
```

## 9. 验收标准

### 9.1 功能验收标准
```
用户管理功能：
□ 用户登录登出正常
□ 三级权限控制正确
□ 页面访问权限验证有效

数据录入功能：
□ 7个模块数据录入正常
□ 实验编码自动生成正确
□ 数据验证规则有效
□ 文件上传功能正常
□ 草稿保存和提交功能正常

数据管理功能：
□ 数据查询展示正确
□ 编辑删除功能正常（权限控制）
□ 导出功能正常
□ 搜索下拉框功能正常

高级功能：
□ 数据对比功能正确
□ 系统管理功能完整
□ 备份恢复功能正常
```

### 9.2 性能验收标准
```
响应时间：
□ 页面加载时间 < 3秒
□ 数据查询响应 < 2秒
□ 文件上传处理 < 5秒

并发性能：
□ 支持5个用户同时操作
□ 系统稳定性测试通过

数据处理：
□ 支持1万条记录查询
□ 大文件上传处理正常
□ 数据导出效率达标
```

## 10. 风险控制

### 10.1 技术风险
- **开发环境差异：** 提供详细的环境搭建文档和依赖版本锁定
- **数据库兼容性：** 使用标准SQL语法和SQLAlchemy ORM
- **文件上传安全：** 严格的文件类型验证和存储路径控制
- **性能瓶颈：** 大数据量查询优化和分页处理
- **浏览器兼容性：** 使用现代前端框架确保兼容性

### 10.2 业务风险
- **需求变更：** 采用模块化设计，便于功能调整和扩展
- **用户培训：** 提供详细的用户操作手册和培训支持
- **数据迁移：** 如有历史数据，提供Excel导入功能
- **系统采用：** 设计直观的用户界面，降低学习成本

### 10.3 数据风险
- **数据丢失：** 实现自动备份机制和操作日志记录
- **数据错误：** 严格的数据验证规则和二次确认机制
- **并发冲突：** 乐观锁机制处理数据并发修改
- **权限泄露：** 多层权限验证确保数据安全

## 11. 后续扩展规划

### 11.1 Phase 2 功能扩展（未来开发）
```
高级数据分析功能：
- 工艺参数相关性分析
- 成品质量预测模型
- 实验结果趋势分析
- 自动化报告生成

工艺优化功能：
- 基于历史数据的参数推荐
- 质量控制图表
- 异常检测和预警
- 最佳实践知识库

系统集成功能：
- 与生产设备数据对接
- 外部系统数据交换
- 移动端APP开发
- 云端部署方案
```

### 11.2 技术架构演进
```
微服务架构：
- 数据服务独立部署
- 分析服务模块化
- API网关统一管理

大数据处理：
- 数据仓库建设
- 实时数据处理
- 机器学习平台集成

云原生部署：
- 容器化部署
- 自动化运维
- 弹性伸缩能力
```

---

## 附录

### A. 完整字段清单（90个字段详细定义）

#### A.1 实验设计参数模块（10个字段）
| 编号 | 中文名称 | 英文名称 | 数据格式 | 必填 | 下拉选择 | 备注 |
|------|----------|----------|----------|------|----------|------|
| 1.1 | PI膜厚度（μm） | pi_film_thickness | 数值 | 是 | 搜索下拉 | PI膜的出厂厚度 |
| 1.2 | 客户类型 | customer_type | 字符串 | 是 | 普通下拉 | I/D/N三选项 |
| 1.3 | 客户名称 | customer_name | 字符串 | 是 | 搜索下拉 | 客户名称及代码 |
| 1.4 | PI膜型号 | pi_film_model | 字符串 | 是 | 搜索下拉 | PI膜的规格 |
| 1.5 | 实验申请日期 | experiment_date | 日期 | 是 | 无 | 实验申请日期 |
| 1.6 | 烧制地点 | sintering_location | 字符串 | 是 | 搜索下拉 | 碳化和石墨化厂区 |
| 1.7 | 送烧材料类型 | material_type_for_firing | 字符串 | 是 | 普通下拉 | R/P两选项 |
| 1.8 | 压延方式 | rolling_method | 字符串 | 是 | 普通下拉 | IF/IR/OF/OR四选项 |
| 1.9 | 实验编组 | experiment_group | 数值 | 是 | 无 | 相同条件的编组 |
| 1.10 | 实验编码 | experiment_code | 字符串 | 自动生成 | 无 | 唯一实验标识 |

#### A.2 PI膜参数模块（6个字段）
| 编号 | 中文名称 | 英文名称 | 数据格式 | 必填 | 下拉选择 | 备注 |
|------|----------|----------|----------|------|----------|------|
| 2.1 | PI膜厂商 | pi_manufacturer | 字符串 | 是 | 搜索下拉 | PI膜供应商名称 |
| 2.2 | PI膜厚度（μm） | pi_thickness_detail | 数值 | 是 | 搜索下拉 | 与1.1相同输入字段 |
| 2.3 | PI膜型号 | pi_model_detail | 字符串 | 是 | 无 | 与1.4相同输入字段 |
| 2.4 | PI膜宽幅（mm） | pi_width | 数值 | 否 | 无 | PI膜的裁切宽带 |
| 2.5 | 批次号 | batch_number | 字符串 | 否 | 无 | 供应商提供信息 |
| 2.6 | PI重量（kg） | pi_weight | 数值 | 是 | 无 | PI的重量信息 |

#### A.3 松卷参数模块（4个字段）
| 编号 | 中文名称 | 英文名称 | 数据格式 | 必填 | 下拉选择 | 备注 |
|------|----------|----------|----------|------|----------|------|
| 3.1 | 卷芯筒类型 | core_tube_type | 字符串 | 否 | 无 | - |
| 3.2 | 松卷间隙卷内（μm） | loose_gap_inner | 数值 | 否 | 无 | - |
| 3.3 | 松卷间隙卷中（μm） | loose_gap_middle | 数值 | 否 | 无 | - |
| 3.4 | 松卷间隙卷外（μm） | loose_gap_outer | 数值 | 否 | 无 | - |

#### A.4 碳化参数模块（20个字段）
[包含碳化炉编号、炉次、温度、时长、成碳率等参数，以及照片文件上传字段]

#### A.5 石墨化参数模块（29个字段）
[包含石墨化炉编号、温度、压力、收缩比等参数，以及照片文件上传字段]

#### A.6 压延参数模块（4个字段）
[包含压延机台、压力、张力、速度等参数]

#### A.7 成品参数模块（16个字段）
[包含成品编码、厚度、密度、导热系数、机械性能等参数，以及照片文件上传字段]

### B. 下拉选择选项配置
```json
{
  "customer_type": [
    {"value": "I", "label": "I：国际客户（International）"},
    {"value": "D", "label": "D：国内客户（Domestic）"}, 
    {"value": "N", "label": "N：内部客户（Neibu）"}
  ],
  "customer_name": [
    {"value": "RD", "label": "RD/研发"},
    {"value": "MP", "label": "MP/量产"},
    {"value": "SA", "label": "SA/三星"},
    {"value": "ME", "label": "ME/Meta"},
    {"value": "HW", "label": "HW/华为"}
  ],
  "sintering_location": [
    {"value": "DG", "label": "DG：碳化（Dongguan） + 石墨化（Dongguan）"},
    {"value": "XT", "label": "XT：碳化（湘潭/Xiangtan） + 石墨化（湘潭/Xiangtan）"},
    {"value": "DX", "label": "DX：碳化（东莞/Dongguan） + 石墨化（湘潭/Xiangtan）"},
    {"value": "WF", "label": "WF：外发"}
  ],
  "material_type_for_firing": [
    {"value": "R", "label": "R：卷材（Roll）"},
    {"value": "P", "label": "P：片材（Plate）"}
  ],
  "rolling_method": [
    {"value": "IF", "label": "IF：内部平压（In-house Flat）"},
    {"value": "IR", "label": "IR：内部辊压（In-house Roll）"},
    {"value": "OF", "label": "OF：外发平压（Outsource Flat）"},
    {"value": "OR", "label": "OR：外发辊压（Outsource Roll）"}
  ]
}
```

### C. API接口设计概要
```
认证接口：
POST /api/auth/login          # 用户登录
POST /api/auth/logout         # 用户登出
GET  /api/auth/profile        # 获取用户信息

实验数据接口：
GET    /api/experiments           # 获取实验列表
POST   /api/experiments           # 创建新实验
GET    /api/experiments/{id}      # 获取实验详情
PUT    /api/experiments/{id}      # 更新实验数据
DELETE /api/experiments/{id}      # 删除实验记录
POST   /api/experiments/{id}/draft # 保存草稿

文件上传接口：
POST /api/upload                  # 文件上传
GET  /api/files/{path}           # 文件下载

数据查询接口：
GET  /api/search/dropdown        # 下拉选择数据
POST /api/search/experiments     # 高级搜索
POST /api/export/csv             # 数据导出

系统管理接口：
GET    /api/users               # 用户列表
POST   /api/users               # 创建用户
PUT    /api/users/{id}          # 更新用户
DELETE /api/users/{id}          # 删除用户
POST   /api/backup              # 数据备份
POST   /api/restore             # 数据恢复
```

### D. 开发环境配置指南
```bash
# Python后端环境
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt

# Node.js前端环境  
npm install
npm run dev

# MySQL数据库配置
CREATE DATABASE graphite_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'graphite_user'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON graphite_db.* TO 'graphite_user'@'localhost';
```

---

**文档版本：** v1.0  
**最后更新：** 2025年  
**文档状态：** 待确认和补充